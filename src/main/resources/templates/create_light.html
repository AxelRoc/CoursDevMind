<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Getting Started: Serving Web Content</title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>

<script src="https://unpkg.com/vue"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>


<div id="create_light">

    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Philips Hue Control Platform</a>
            </div>
            <ul class="nav navbar-nav">
                <li class="active"><a href="/">Home</a></li>
                <li><a href="/create_building">Create Building</a></li>
                <li><a href="/create_room">Create Room</a></li>
                <li><a href="/create_light">Create Light</a></li>
            </ul>
        </div>
    </nav>

    <h1>Create a light</h1>
    <select v-model="light_buildingId" @click="search_rooms_for_create_light()">
        <option value="" disabled selected>Select a building</option>
        <option v-for="building in allbuildings" v-bind:value="building.id">
            {{ building.name }}
        </option>
    </select>
    <select v-model="light_roomId" >
        <option value="" disabled selected>Select a room</option>
        <option v-for="room in roomsForCreateLight" v-bind:value="room.id">
            {{ room.name }}
        </option>
    </select>
    <button @click="createLight()" class="btn btn-light">create</button>
    <p>{{message}}</p>
</div>

<script>

var url = "http://localhost:8080/api"

var building_vue = new Vue({

  el: '#create_light',
  data: {
  building_name: '',
  light_buildingId: '',
  allbuildings: [],
  allrooms: [],
  light_roomId: '',
  roomsForCreateLight: [],
  message: ''
  },
   created(){
  	let get_buildings_url = url + "/buildings";
   	fetch(get_buildings_url)
    .then(response => response.json())
    .then(json => {this.allbuildings = json
    });
    let get_rooms_url = url + "/rooms";
   	fetch(get_rooms_url)
    .then(response => response.json())
    .then(json => {this.allrooms = json
    });
  },
  methods: {

  createLight: function(){
    var create_light_url = url + "/lights";
    console.log(this.light_roomId);
    console.log(this.light_buildingId);

    if( this.light_roomId != '' && this.light_buildingId != '' ){
        var string_post = '{"status": "OFF" , "brightness": "0", "color": "vert", "level" : 9 , "roomId": ' + this.light_roomId + '}';
        var json_post = JSON.parse(string_post);
        axios.post(create_light_url , json_post);
        this.message = 'the light has been added';
    }
    else{this.message = 'please select a building and a room';}

  },

  search_rooms_for_create_light: function(){
        this.roomsForCreateLight = [];
  	    for (var i in this.allrooms){
    	    if (this.allrooms[i]["buildingId"] == this.light_buildingId){
    		    this.roomsForCreateLight.push(this.allrooms[i]);
    	    }
        };
  }

}})

</script>



</body>
</html>